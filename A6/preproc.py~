import vigenere
import re
import time
import random

def antiKasiski(key, plaintext, chars):
    
    key = key.upper()
    chars = list(chars)
    repetitions = True

    while repetitions:
    
        cipherText = vigenere.vigenere(key, plaintext, 'encrypt')
        #cipherText = cipherText.strip('\n')
    
        substring, index= locateRepetitions(cipherText)
        print(substring)
        
        if substring == None :
            repetitions = False
        else:
            plaintext = insertChar(index, chars, plaintext)
            repetitions = True

        
        print(plaintext)
    return plaintext
    	
def insertChar(index, chars, plaintext):
    char = random.choice(chars)
    plaintext = plaintext[:index] + char + plaintext[index:]
    return plaintext


def locateRepetitions(cipherText):
    
    lengthOfSubstring = 3
    textLen = len(cipherText)
    visited = {}
    while lengthOfSubstring <= textLen//2:
        for index in range(textLen - lengthOfSubstring):

            substring = cipherText[index: index+lengthOfSubstring]
            if substring not in visited.keys():
                visited[substring] = [index, index+lengthOfSubstring]
            else:
                if index > visited[substring][1]-1:
                    print(visited)
                    return substring, index

        lengthOfSubstring += 1

    return None, None

	






def main():
    #-----------------------------------------------------/V--------
    plaintext = 'THOSEPOLICEOFFICERSOFFEREDHERARIDEHOMETHEYTELLTHEMAJOKETHOSEBARBERSLENTHERALOTOFMONEY'
    antiPlainText = antiKasiski('WICK', plaintext, 'X')
    if antiPlainText == 'THOSEPOLICEOFFICERSXOFFEREDHERARIDEHOMETHEYTELLXTHEMAJOKETHOSEBARBERSLENXTHERALOTOFMONEY':
        print('Texts Match:')
        print(antiPlainText)
    else:
        print("Texts Do Not Match:")
        print("Created: " + antiPlainText)
        print("Actual : " + 'THOSEPOLICEOFFICERSXOFFEREDHERARIDEHOMETHEYTELLXTHEMAJOKETHOSEBARBERSLENXTHERALOTOFMONEY')
        print("CipherText        :" + vigenere.vigenere('WICK', antiPlainText, 'decrypt'))
        print("Actual Cipher Text:" + vigenere.vigenere('WICK', 'THOSEPOLICEOFFICERSXOFFEREDHERARIDEHOMETHEYTELLXTHEMAJOKETHOSEBARBERSLENXTHERALOTOFMONEY', 'decrypt' ))		

if __name__ == '__main__':
    main()

